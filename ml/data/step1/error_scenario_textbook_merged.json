[
    {
        "id": 0,
        "preprocessed_group": "# 에러 처리 시나리오\n### 1. 도킹 전 알람\n\n- 도킹 하기 전 도킹 위치 정밀 확인 실패\n- 알람코드\n    - [80018] DOCK_NOT_FIND\n- API 활용 에러 클리어 시나리오\n    1. AMR 상태 조회\n\n        ```python\n        {\n            \"NetId\": “R_101\",\n            …,\n            \"Errors\": [\n              {\n                \"Type\": \"string\",\n                \"Level\": \"string\",\n                \"Code\": 0,\n                \"Message\": \"string\",\n                \"Time\": \"2024-01-01T00:00:00\"\n              }\n            ]\n          }\n\n        ```\n\n    2. Error Code 확인 : Dock not find\n    3. ACS Job Cancel (`PUT /api/command/cancel`)\n    4. MCS Command 목록 조회 (`GET /api/Object/Mission`)\n    5. MCS CallRetry - 조회된 명령 중 filter\n\n        ```python\n          - if (amrNetId &&\n                 (e.ASSIGNED_WORKER == amrNetId || e.DATA_1 == amrNetId))\n        `PUT /api/Command/retrycommand`\n        {\n            “mission”: “”,\n        // 로봇 미션\n            “robot”: “R_101”,\n        }\n\n        ```\n\n    6. ACS AMR AUTO로 변환 (`PUT /api/command/mode`)\n\n",
        "textbook": "## [SOP] 도킹 전 위치 인식 실패 시 복구 절차 (Scenario 1)\n\n**1. 절차 개요**\n본 절차는 AMR이 설비 도킹을 시도하기 직전, 정밀 위치 보정 마커(Reflector 등)를 인식하지 못해 작업이 중단되었을 때 수행하는 표준 복구 프로세스다. 발생 알람 코드는 `[80018] DOCK_NOT_FIND`이며, 해당 절차는 상위 시스템(MCS)과 로봇 제어 시스템(ACS) 간의 상태 불일치를 해소하고 작업을 재시도(Retry)시키는 것을 목적으로 한다.\n\n**2. 상세 수행 절차**\n가장 먼저 시스템은 `GET /api/object/status`를 호출하여 해당 AMR의 실시간 상태 정보를 수집해야 한다. 이는 무조건적인 복구 명령 전송을 방지하고, 현재 발생한 에러가 실제 복구 대상인 `[80018] DOCK_NOT_FIND`인지 명확히 검증하기 위함이다. 응답받은 `Errors` 배열 내의 Code와 Message를 대조하여 도킹 위치 인식 실패임이 확인되면 후속 조치를 시작한다.\n\n에러가 검증되었다면, 우선적으로 `PUT /api/command/cancel`을 실행하여 ACS 상에 잔존하는 '실패한 작업(Job)'을 강제로 종료한다. 이는 로봇이 에러 상태(Error State)에서 벗어나 새로운 명령을 수신할 수 있는 대기 상태(Idle/Ready)로 전환하기 위한 필수적인 선행 조치다.\n\n로봇의 로컬 작업이 취소된 후에는 상위 시스템인 MCS 차원에서의 작업 재할당이 필요하다. 이를 위해 `GET /api/Object/Mission`을 조회하여 현재 전체 미션 리스트를 확보한다. 확보된 리스트 중에서 `ASSIGNED_WORKER` 또는 `DATA_1` 필드가 현재 에러가 발생했던 `amrNetId`와 일치하는 미션을 필터링하여 찾아낸다.\n\n정확한 타겟 미션이 식별되면, `PUT /api/Command/retrycommand`를 호출하여 MCS가 해당 로봇(`R_101` 등)에게 작업을 다시 지시하도록 트리거한다. 마지막으로 로봇이 재전송된 명령을 자율적으로 수행할 수 있도록 `PUT /api/command/mode`를 통해 AMR의 운전 모드를 `AUTO`로 갱신함으로써, 도킹 재시도를 위한 모든 복구 절차를 완료한다."
    },
    {
        "id": 1,
        "preprocessed_group": "# 에러 처리 시나리오\n### 2. 도킹 중 알람\n\n- 도킹 중 하드웨어 등의 이슈로 인해 알람 발생\n- 알람코드\n    - [80023] DOCKING_POS_EXCEED\n    - [80024] DOCKING_TIMEOUT\n- API 활용 에러 클리어 시나리오\n    1. AMR 상태 조회\n\n        ```python\n        {\n            \"NetId\": “R_101\",\n            …,\n            \"Errors\": [\n              {\n                \"Type\": \"string\",\n                \"Level\": \"string\",\n                \"Code\": 0,\n                \"Message\": \"string\",\n                \"Time\": \"2024-01-01T00:00:00\"\n              }\n            ]\n          }\n\n        ```\n\n    2. Error Code 확인\n    3. ACS Job Cancel (`PUT /api/command/cancel`)\n    4. 유저에게 충돌 여부 확인 및 수동 이동(Jog 명령) 지시문구 안내\n        - 충돌X, 수동 이동으로 안전한 위치로 옮겼다면 아래 부터 실행\n    5. MCS Command 목록 조회 (`GET /api/Object/Mission`)\n    6. MCS CallRetry – 조회된 명령 중 filter\n\n        ```python\n          - if (amrNetId &&\n                 (e.ASSIGNED_WORKER == amrNetId || e.DATA_1 == amrNetId))\n        `PUT /api/Command/retrycommand`\n        {\n            “mission”: “”,\n        // 로봇 미션\n            “robot”: “R_101”,\n        }\n\n        ```\n\n    7. ACS AMR AUTO로 변환 (`PUT /api/command/mode`)\n\n",
        "textbook": "## [SOP] 도킹 중 알람 발생 시 복구 절차 (Scenario 2)\n\n**1. 절차 개요**\n본 절차는 AMR이 설비와 도킹(Docking)을 시도하던 중 하드웨어 위치 오차(`[80023] DOCKING_POS_EXCEED`)나 시간 초과(`[80024] DOCKING_TIMEOUT`) 등의 사유로 알람이 발생했을 때 수행하는 표준 복구 프로세스다. 물리적 충돌 위험을 배제하고 시스템을 안전하게 재가동하여 중단된 미션을 재개하는 것을 목적으로 한다.\n\n**2. 상세 수행 절차**\n\n가장 먼저 시스템은 `GET /api/object/status`를 호출하여 AMR의 실시간 상태 정보를 조회해야 한다. 응답 데이터 내 `Errors` 배열을 분석하여 발생한 알람 코드가 도킹 관련 오류(`80023` 또는 `80024`)인지 명확히 식별함으로써, 잘못된 복구 절차가 적용되는 것을 방지한다.\n\n오류 원인이 확인되면, 즉시 `PUT /api/command/cancel`을 실행하여 현재 수행 중인 ACS Job을 강제 취소한다. 이는 이미 실패한 도킹 시도를 로봇이 계속 수행하려다 발생할 수 있는 2차 사고를 막기 위함이다. Job 취소 후에는 소프트웨어적 제어에 앞서 **물리적 안전 확보**가 선행되어야 한다. 운영자는 현장에서 AMR과 설비 간의 충돌 여부를 육안으로 확인하고, Jog 명령을 통해 AMR을 안전한 위치로 수동 이동시켜야 한다.\n\nAMR이 안전한 위치로 이동하여 충돌 위험이 해소된 것이 확인되면, 중단된 작업을 복구하는 단계로 진입한다. 우선 `GET /api/Object/Mission`을 통해 현재 MCS에 등록된 전체 명령 목록을 조회한다. 조회된 목록 중 `ASSIGNED_WORKER` 또는 `DATA_1` 필드가 해당 `amrNetId`와 일치하는 미션을 필터링하여, 중단되었던 작업을 특정한다.\n\n작업 식별 후 `PUT /api/Command/retrycommand`를 호출하여 MCS에 미션 재시도(CallRetry)를 요청한다. 마지막으로, 수동 이동(Jog) 과정에서 매뉴얼 모드로 변경되었을 가능성이 있는 AMR의 제어권을 시스템으로 복귀시키기 위해 `PUT /api/command/mode`를 실행하여 상태를 **AUTO**로 전환한다. 이를 통해 AMR은 재할당된 미션을 수신하고 정상적인 도킹 프로세스를 다시 시작하게 된다."
    },
    {
        "id": 2,
        "preprocessed_group": "# 에러 처리 시나리오\n### 3. 차상 작업 전 알람\n\n- 적재물 센서 미감지 혹은 설비의 알람 발생 등\n- 알람코드\n    - [70008] [PLC] U_REQ/L_REQ OFF ALARM\n    - [70009] [PLC] READY OFF ALARM\n    - [70010] [PLC] WORK START TIME OVER ALARM\n    - [70011] [PLC] T2 TIME OVER ALARM\n- API 활용 에러 클리어 시나리오\n    1. AMR 상태 조회\n\n        ```python\n        {\n            \"NetId\": “R_101\",\n            …,\n            \"CurrentRackObject\": \"string\",\n            \"CurrentRackDockOutArea\": \"string\",\n            \"Errors\": [\n              {\n                \"Type\": \"string\",\n                \"Level\": \"string\",\n                \"Code\": 0,\n                \"Message\": \"string\",\n                \"Time\": \"2024-01-01T00:00:00\"\n              }\n            ]\n          }\n\n        ```\n\n    2. Error Code 확인\n    3. ACS Job Cancel (`PUT /api/command/cancel`)\n    4. 현재 Rack 위치 획득(1번에서 획득한 status)\n        - CurrentRackObject 체크\n        - 없으면 CurrentRackDockOutArea 체크\n    5. PLC 시나리오 실행 – dock_reset (`PUT /api/plc/placecommand` )\n        - {Place: Rack, Command: dock_reset}\n    6. PLC 시나리오 실행 – dock_ok (`PUT /api/plc/placecommand` )\n        - {Place: Rack, Command: dock_ok}\n    7. MCS Command 목록 조회 (`GET /api/Object/Mission`)\n    8. MCS CallRetry – 조회된 명령 중 filter\n\n        ```python\n          - if (amrNetId &&\n                 (e.ASSIGNED_WORKER == amrNetId || e.DATA_1 == amrNetId))\n        `PUT /api/Command/retrycommand`\n        {\n            “mission”: “”, // 로봇 미션\n            “robot”: “R_101”,\n        }\n\n        ```\n\n    9. ACS AMR AUTO로 변환 (`PUT /api/command/mode`)\n\n",
        "textbook": "## [SOP] 차상 작업 전 알람 발생 시 복구 절차 (Scenario 3)\n\n**1. 절차 개요**\n본 절차는 AMR이 설비에 도착하여 작업을 시작하기 직전, 적재물 센서 미감지나 PLC와의 신호 인터페이스 타임아웃(U_REQ/L_REQ OFF, READY OFF 등)으로 인해 알람(Code: 70008 ~ 70011)이 발생했을 때 수행하는 표준 복구 프로세스다. 설비와 로봇 간의 통신 상태를 초기화하고 작업을 재개하여 공정 지연을 최소화하는 것을 목적으로 한다.\n\n**2. 상세 수행 절차**\n장애 발생 시 가장 먼저 시스템은 `GET /api/object/status`를 호출하여 AMR의 상태를 조회해야 한다. 이는 단순히 에러 발생 여부를 확인하는 것을 넘어, 현재 발생한 에러 코드가 핸드쉐이킹 관련 오류(70008~70011)인지 검증하고, 후속 조치에 필요한 `NetId`와 현재 위치 정보를 확보하기 위함이다.\n\n에러 코드가 확인되면, 교착 상태에 빠진 현재 작업을 중단하기 위해 `PUT /api/command/cancel`을 실행한다. 이는 이미 타임아웃이나 신호 불일치로 인해 실패한 작업을 강제로 종료시킴으로써, 시스템이 새로운 복구 명령을 수신할 수 있는 상태로 만들기 위함이다.\n\n작업 취소 후에는 앞서 조회한 상태 정보에서 `CurrentRackObject`를 확인하여 AMR이 위치한 정확한 Rack(설비) 명칭을 파악한다. 만약 해당 값이 비어있다면 `CurrentRackDockOutArea`를 참조하여 위치를 특정한다. 위치 정보가 확보되면 설비(PLC)의 에러 상태를 해제하기 위해 `PUT /api/plc/placecommand`를 통해 `dock_reset` 명령을 전송한다. 이어서 `dock_ok` 명령을 순차적으로 인가하는데, 이는 PLC가 AMR의 도킹 상태를 정상으로 재인식하게 하여 중단된 신호 교환(Handshaking)을 다시 시작할 준비를 마치게 하기 위함이다.\n\n설비 측의 준비가 완료되면 상위 시스템(MCS)과의 데이터 동기화를 수행한다. `GET /api/Object/Mission`을 통해 현재 계류 중인 미션 목록을 조회하고, 해당 AMR(`amrNetId`)에 할당된 미션을 필터링한다. 식별된 미션에 대해 `PUT /api/Command/retrycommand`를 호출하여 작업을 재시도(Retry) 시킨다.\n\n마지막으로 AMR이 재전송된 미션을 자율적으로 수행할 수 있도록 `PUT /api/command/mode`를 호출하여 로봇의 상태를 **AUTO**로 전환함으로써 복구 절차를 완료한다."
    },
    {
        "id": 3,
        "preprocessed_group": "# 에러 처리 시나리오\n### 4. 차상 작업 중 알람\n\n- 적재물 이적재 실패 등\n- 알람코드\n    - [70012] [PLC] T4 TIME OVER ALARM\n- API 활용 에러 클리어 시나리오\n    1. AMR 상태 조회\n\n        ```python\n        {\n            \"NetId\": “R_101\",\n            …,\n            \"LoadedState\": int,\n            \"Errors\": [\n              {\n                \"Type\": \"string\",\n                \"Level\": \"string\",\n                \"Code\": 0,\n                \"Message\": \"string\",\n                \"Time\": \"2024-01-01T00:00:00\"\n              }\n            ]\n          }\n\n        ```\n\n    2. Error Code 확인\n    3. LoadedState 확인\n        - 0 : 없음, 1 : 1개(전방), 2: 1개(후방), 3 : 2개(전후방)\n    4. ACS Job Cancel (`PUT /api/command/cancel`)\n    5. 유저에게 적재물이 정상적으로 적재되었는지 확인 문구\n        - 정상적재 되었다면 아래 실행\n    6. PLC 시나리오 실행 – dock_reset (`PUT /api/plc/placecommand` )\n        - {Place: Rack, Command: dock_reset}\n    7. PLC 시나리오 실행 – dock_ok (`PUT /api/plc/placecommand` )\n        - {Place: Rack, Command: dock_ok}\n    8. 적재물 정보 입력 (`PUT /api/command/payload`)\n\n        ```python\n        {\n          \"Target\": “R_101\",\n          \"type\": \" save\",\n          \"payload\": [\n            {\n              \"RackIndex\": 0,\n              \"PLTNo\": \"\",\n              \"PLTType\": \"string\", // “BMA”\n              \"PartType\": 0,\n              \"PLTTypeNo\": 0,\n              \"PLTStatus\": 0, // 0:None, 1 : Empty, 2 : Full\n              \"PartID\": \"\",\n              \"PartNo\": \"\",\n              \"PartCount\": 0,\n              \"PartStatus\": 0 // 1 : OK, 0 : NG\n            }\n          ]\n        }\n\n        ```\n\n    9. ACS AMR AUTO로 변환 (`PUT /api/command/mode`)\n",
        "textbook": "## [SOP] 차상 작업 중 알람 발생 시 복구 절차 (Scenario 4)\n\n**1. 절차 개요**\n본 절차는 AMR이 설비와 적재물을 이적재(Transfer)하는 도중, `[70012] [PLC] T4 TIME OVER ALARM` 등과 같은 타임아웃 알람이 발생하여 작업이 중단되었을 때 수행하는 표준 복구 프로세스다. 물리적 적재는 완료되었으나 시스템상 처리가 누락된 경우, 데이터 정합성을 맞추고 설비를 정상화하는 데 목적이 있다.\n\n**2. 상세 수행 절차**\n장애가 감지되면 우선 `GET /api/object/status`를 호출하여 AMR의 상세 상태를 조회해야 한다. 반환된 데이터 중 `Errors` 배열 내의 코드를 분석하여 T4 TIME OVER와 같은 특정 알람인지 식별하고, 동시에 `LoadedState` 값을 확인하여 시스템이 현재 적재물의 유무를 어떻게 인식하고 있는지 파악한다. 이는 후속 조치의 기준이 되는 진단 단계이다.\n\n현재 걸려 있는 에러 상태를 해제하고 제어권을 확보하기 위해 `PUT /api/command/cancel`을 실행하여 진행 중인 ACS Job을 강제 취소한다. 그 후, 시스템 데이터와 실제 물리적 상황의 괴리를 파악하기 위해 운영자가 직접 현장을 확인해야 한다. 적재물이 정상적으로 이적재되었는지 육안으로 검증하며, 만약 정상적으로 적재된 상태라면 다음 단계로 진행한다.\n\n물리적 적재가 완료되었음에도 설비(PLC)가 에러 상태로 남아있으므로, `PUT /api/plc/placecommand`를 통해 `dock_reset` 명령을 전송하여 PLC 레지스터를 초기화한다. 이어 `dock_ok` 명령을 전송함으로써 설비 측에 작업이 완료되었음을 강제로 인식시켜 인터페이스 상태를 동기화한다.\n\n설비 신호 복구 후에는 AMR 내부의 데이터 정합성을 맞춰야 한다. 알람으로 인해 적재 정보가 누락되었을 가능성이 높으므로, `PUT /api/command/payload`를 호출하여 현재 적재된 화물의 정보(RackIndex, PLTType, Status 등)를 수동으로 주입(Save)한다. 모든 물리적, 논리적 상태가 일치됨이 확인되면 마지막으로 `PUT /api/command/mode`를 사용하여 AMR을 AUTO 모드로 전환, 중단된 물류 흐름을 재개한다."
    }
]